<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sign Up - Smart Maintenance</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <a href="index.html"><img id="site-logo" src="../assets/images/logo.svg" alt="Smart Maintenance logo"></a>
      </div>
      <nav class="nav">
        <a href="index.html">ğŸ  Home</a>
        <a href="student.php">ğŸ‘©â€ğŸ“ Student</a>
        <a href="admin.php">ğŸ§‘â€ğŸ’¼ Admin</a>
        <a href="technician.php">ğŸ› ï¸ Technician</a>
      </nav>
    </div>
  </header>

  <main class="container hero-card">
    <h2>Create account</h2>

    <form id="signupForm" class="form">
      <label>Name
        <input name="name" required />
      </label>
      <label>Email
        <input name="email" type="email" required />
      </label>
      <label>Password
        <input name="password" type="password" required />
      </label>

      <label>Role
        <select id="roleSelect" name="role">
          <option value="student" selected>Student</option>
          <option value="technician">Technician</option>
          <option value="admin">Admin</option>
        </select>
      </label>

      <!-- Technician type dropdown -->
      <div id="techTypeWrap" style="display:none;">
        <label>Technician Type
          <select name="tech_type">
            <option value="">Select Technician Type</option>
            <option value="Electrical">Electrical</option>
            <option value="Plumbing">Plumbing</option>
            <option value="Carpentry">Carpentry</option>
            <option value="Cleaning">Cleaning</option>
          </select>
        </label>
      </div>

      <div class="form-row">
        <button class="btn primary" type="submit">Create account</button>
        <a class="btn ghost" href="login.html">Back to login</a>
      </div>
    </form>

    <p id="msg" style="color:green"></p>
  </main>

  <script src="../assets/js/app.js"></script>
  <script>
    const roleSelect = document.getElementById('roleSelect');
    const techWrap = document.getElementById('techTypeWrap');

    // Show/hide technician type dropdown based on selected role
    roleSelect.addEventListener('change', () => {
      techWrap.style.display = (roleSelect.value === 'technician') ? 'block' : 'none';
    });

    // Handle signup form
    document.getElementById('signupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = new FormData(e.target);
      try {
        const j = await postForm('../backend/signup.php', form);
        const msg = document.getElementById('msg');
        if (j && j.success) {
          msg.style.color = 'green';
          msg.textContent = 'Signed up successfully â€” redirecting to login...';
          setTimeout(() => window.location.href = 'login.html', 800);
        } else {
          msg.style.color = 'red';
          msg.textContent = 'Error: ' + (j && j.error ? j.error : 'unknown');
        }
      } catch (err) {
        document.getElementById('msg').style.color = 'red';
        document.getElementById('msg').textContent = 'Network or server error: ' + err.message;
      }
    });
  </script>
</body>
</html>
